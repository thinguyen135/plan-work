<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Daily Game</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Animation t√πy ch·ªânh */
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-slow {
            animation: bounce-slow 3s infinite;
        }
        body {
            user-select: none; /* Tr√°nh b√¥i ƒëen khi click nhi·ªÅu */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICON COMPONENTS (Thay th·∫ø cho lucide-react) ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"></polyline></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconBase>;
        const Utensils = (props) => <IconBase {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></IconBase>;
        const Heart = (props) => <IconBase {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M8 21h8m-4-9v9m-4.8-9a3 3 0 1 1 0-6 4 4 0 1 1 0 8m9.6 0a3 3 0 1 0 0-6 4 4 0 1 0 0 8"></path></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></IconBase>;

        // --- MAIN APP ---
        const APP_DATA_KEY = 'pet_daily_data_v1';

        function App() {
            // --- STATE ---
            const [pet, setPet] = useState({
                name: 'Pet',
                level: 1,
                exp: 0,
                hunger: 80, 
                happiness: 80, 
                type: 'cat', 
                stage: 'egg', 
                bornDate: Date.now(),
            });

            const [inventory, setInventory] = useState({
                food: 2, 
            });

            const [tasks, setTasks] = useState([
                { id: 1, text: 'U·ªëng m·ªôt c·ªëc n∆∞·ªõc', completed: false },
                { id: 2, text: 'ƒê·ªçc s√°ch 15 ph√∫t', completed: false },
            ]);

            const [newTaskInput, setNewTaskInput] = useState('');
            const [notification, setNotification] = useState(null);
            const [showTutorial, setShowTutorial] = useState(false);

            // --- LOGIC & EFFECTS ---
            useEffect(() => {
                const savedData = localStorage.getItem(APP_DATA_KEY);
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setPet(parsed.pet);
                        setInventory(parsed.inventory);
                        setTasks(parsed.tasks);
                    } catch (e) {
                        console.error("L·ªói ƒë·ªçc d·ªØ li·ªáu c≈©", e);
                    }
                } else {
                    setShowTutorial(true);
                }
            }, []);

            useEffect(() => {
                localStorage.setItem(APP_DATA_KEY, JSON.stringify({ pet, inventory, tasks }));
            }, [pet, inventory, tasks]);

            useEffect(() => {
                const timer = setInterval(() => {
                    setPet(prev => ({
                        ...prev,
                        hunger: Math.max(0, prev.hunger - 2),
                        happiness: Math.max(0, prev.happiness - 1)
                    }));
                }, 30000); 
                return () => clearInterval(timer);
            }, []);

            const showNoti = (text, type = 'success') => {
                setNotification({ text, type });
                setTimeout(() => setNotification(null), 2000);
            };

            // --- X·ª¨ L√ù NHI·ªÜM V·ª§ ---
            const addTask = (e) => {
                e.preventDefault();
                if (!newTaskInput.trim()) return;
                const newTask = {
                    id: Date.now(),
                    text: newTaskInput,
                    completed: false
                };
                setTasks([...tasks, newTask]);
                setNewTaskInput('');
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => {
                    if (t.id === id) {
                        const isNowCompleted = !t.completed;
                        if (isNowCompleted) {
                            setInventory(prev => ({ ...prev, food: prev.food + 1 }));
                            showNoti('+1 Th·ª©c ƒÉn!', 'success');
                            setPet(prev => ({...prev, happiness: Math.min(100, prev.happiness + 5)}));
                        }
                        return { ...t, completed: isNowCompleted };
                    }
                    return t;
                }));
            };

            const deleteTask = (id) => {
                setTasks(tasks.filter(t => t.id !== id));
            };

            // --- X·ª¨ L√ù TH√ö C∆ØNG ---
            const getPetEmoji = () => {
                const { stage, type, hunger, happiness } = pet;
                
                if (hunger < 30 || happiness < 30) return 'üòø'; 
                
                if (stage === 'egg') return 'ü•ö';
                
                if (type === 'cat') {
                    if (stage === 'baby') return 'üê±';
                    if (stage === 'adult') return 'üò∫';
                    if (stage === 'master') return 'üòª';
                }
                return 'üëæ';
            };

            const getPetStatusText = () => {
                if (pet.stage === 'egg') return 'ƒêang ·∫•p tr·ª©ng...';
                if (pet.hunger < 30) return 'ƒê√≥i qu√° sen ∆°i!';
                if (pet.happiness < 30) return 'Bu·ªìn ch√°n...';
                if (pet.hunger > 90) return 'No cƒÉng b·ª•ng!';
                return 'ƒêang c·∫£m th·∫•y t·ªët';
            };

            const feedPet = () => {
                if (inventory.food <= 0) {
                    showNoti('H·∫øt th·ª©c ƒÉn r·ªìi! L√†m nhi·ªám v·ª• ƒëi!', 'error');
                    return;
                }
                if (pet.hunger >= 100) {
                    showNoti('B√© no r·ªìi, kh√¥ng ƒÉn n·ªïi n·ªØa!', 'error');
                    return;
                }

                setInventory(prev => ({ ...prev, food: prev.food - 1 }));
                
                const expGain = 15;
                let newLevel = pet.level;
                let newStage = pet.stage;
                let newExp = pet.exp + expGain;
                
                const expNeeded = pet.level * 50;
                if (newExp >= expNeeded) {
                    newLevel += 1;
                    newExp = newExp - expNeeded;
                    showNoti('L√™n c·∫•p!! üéâ', 'success');
                    
                    if (newLevel === 2 && newStage === 'egg') newStage = 'baby';
                    if (newLevel === 5 && newStage === 'baby') newStage = 'adult';
                    if (newLevel === 10 && newStage === 'adult') newStage = 'master';
                } else {
                    showNoti('MƒÉm mƒÉm! Ngon qu√° (+20 ƒê√≥i)', 'success');
                }

                setPet(prev => ({
                    ...prev,
                    hunger: Math.min(100, prev.hunger + 20),
                    happiness: Math.min(100, prev.happiness + 5),
                    exp: newExp,
                    level: newLevel,
                    stage: newStage
                }));
            };

            const playWithPet = () => {
                if (pet.stage === 'egg') {
                    showNoti('Tr·ª©ng ch∆∞a n·ªü ƒë√¢u!', 'error');
                    return;
                }
                if (pet.hunger < 10) {
                    showNoti('ƒê√≥i qu√° kh√¥ng ch∆°i n·ªïi...', 'error');
                    return;
                }
                setPet(prev => ({
                    ...prev,
                    hunger: Math.max(0, prev.hunger - 5),
                    happiness: Math.min(100, prev.happiness + 15),
                    exp: prev.exp + 5 
                }));
                showNoti('Vui qu√° ƒëi! (+15 Vui)', 'success');
            };

            const resetGame = () => {
                if(window.confirm("B·∫°n c√≥ ch·∫Øc mu·ªën nu√¥i l·∫°i t·ª´ ƒë·∫ßu kh√¥ng?")) {
                    localStorage.removeItem(APP_DATA_KEY);
                    window.location.reload();
                }
            }

            const expPercentage = Math.min(100, (pet.exp / (pet.level * 50)) * 100);

            return (
                <div className="min-h-screen bg-orange-50 font-sans text-gray-800 pb-20 md:pb-0">
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col relative">
                    
                    {/* Header */}
                    <div className="bg-orange-500 p-4 text-white flex justify-between items-center shadow-md z-10">
                    <div className="flex items-center gap-3">
                        <button 
                            onClick={() => window.location.href = 'plan.html'}
                            className="flex items-center gap-1 bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full text-sm font-bold transition"
                        >
                            <Calendar size={16} /> L·ªãch
                        </button>
                        <h1 className="text-xl font-bold flex items-center gap-2">
                            <Trophy size={20} /> Pet Daily
                        </h1>
                    </div>
                    <div className="flex gap-2">
                        <button onClick={() => setShowTutorial(!showTutorial)} className="p-1 hover:bg-orange-600 rounded">
                            <Info size={20}/>
                        </button>
                        <div className="bg-orange-700 px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1">
                        <Utensils size={14} /> {inventory.food}
                        </div>
                    </div>
                    </div>

                    {/* Notification Popup */}
                    {notification && (
                    <div className={`absolute top-16 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-full shadow-lg text-white font-bold z-50 animate-bounce ${notification.type === 'error' ? 'bg-red-500' : 'bg-green-500'}`}>
                        {notification.text}
                    </div>
                    )}

                    {/* Tutorial Modal */}
                    {showTutorial && (
                        <div className="absolute inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white p-6 rounded-xl shadow-xl max-w-xs text-center">
                                <h3 className="text-xl font-bold text-orange-600 mb-2">Ch√†o m·ª´ng!</h3>
                                <p className="text-gray-600 mb-4 text-sm">
                                    ƒê√¢y l√† n∆°i b·∫°n bi·∫øn th√≥i quen th√†nh ni·ªÅm vui.
                                </p>
                                <ul className="text-left text-sm space-y-2 mb-6 bg-orange-50 p-3 rounded-lg">
                                    <li>‚úÖ Ho√†n th√†nh 1 vi·ªác = 1 Th·ª©c ƒÉn</li>
                                    <li>üçó Cho ƒÉn = TƒÉng EXP & L√™n c·∫•p</li>
                                    <li>ü•ö C·∫•p 2: Tr·ª©ng n·ªü</li>
                                    <li>üò∫ C·∫•p 5: Tr∆∞·ªüng th√†nh</li>
                                    <li>üìÖ S·ª≠ d·ª•ng <strong>L·ªãch</strong> ƒë·ªÉ l√™n k·∫ø ho·∫°ch</li>
                                </ul>
                                <button 
                                    onClick={() => setShowTutorial(false)}
                                    className="bg-orange-500 text-white px-6 py-2 rounded-full font-bold hover:bg-orange-600 w-full">
                                    ƒê√£ hi·ªÉu!
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Main Content Area */}
                    <div className="flex-1 overflow-y-auto">
                    
                    {/* PET AREA */}
                    <div className="bg-gradient-to-b from-orange-100 to-white p-6 text-center border-b border-orange-100">
                        
                        <div className="mb-2 text-sm text-gray-500 font-semibold uppercase tracking-wider">
                        Level {pet.level} ‚Ä¢ {pet.stage === 'egg' ? 'Tr·ª©ng b√≠ ·∫©n' : pet.stage === 'baby' ? 'Th√∫ s∆° sinh' : 'Tr∆∞·ªüng th√†nh'}
                        </div>

                        {/* Pet Avatar with Animation */}
                        <div className="relative w-32 h-32 mx-auto flex items-center justify-center text-7xl select-none transition-transform duration-300 hover:scale-110 cursor-pointer"
                            onClick={playWithPet}>
                        <div className="animate-bounce-slow">
                            {getPetEmoji()}
                        </div>
                        {/* Click effect helper */}
                        <div className="absolute -bottom-2 text-xs text-gray-400 opacity-50">Ch·∫°m ƒë·ªÉ ch∆°i</div>
                        </div>

                        <p className="mt-2 font-medium text-orange-800 italic">"{getPetStatusText()}"</p>

                        {/* Stats Bars */}
                        <div className="grid grid-cols-2 gap-4 mt-6">
                        <div>
                            <div className="flex justify-between text-xs mb-1 font-bold text-gray-600">
                            <span>ƒê√≥i</span> <span>{pet.hunger}/100</span>
                            </div>
                            <div className="h-3 bg-gray-200 rounded-full overflow-hidden border border-gray-100">
                            <div 
                                className={`h-full transition-all duration-500 ${pet.hunger < 30 ? 'bg-red-400' : 'bg-green-500'}`} 
                                style={{ width: `${pet.hunger}%` }}
                            ></div>
                            </div>
                        </div>
                        
                        <div>
                            <div className="flex justify-between text-xs mb-1 font-bold text-gray-600">
                            <span>Vui v·∫ª</span> <span>{pet.happiness}/100</span>
                            </div>
                            <div className="h-3 bg-gray-200 rounded-full overflow-hidden border border-gray-100">
                            <div 
                                className={`h-full transition-all duration-500 ${pet.happiness < 30 ? 'bg-red-400' : 'bg-yellow-400'}`} 
                                style={{ width: `${pet.happiness}%` }}
                            ></div>
                            </div>
                        </div>
                        </div>

                        {/* EXP Bar */}
                        <div className="mt-4">
                            <div className="flex justify-between text-xs mb-1 font-bold text-blue-600">
                            <span>EXP (Kinh nghi·ªám)</span> 
                            <span>{Math.floor(pet.exp)} / {pet.level * 50}</span>
                            </div>
                            <div className="h-2 bg-blue-100 rounded-full overflow-hidden">
                                <div className="h-full bg-blue-500 transition-all duration-500" style={{width: `${expPercentage}%`}}></div>
                            </div>
                        </div>

                        {/* Actions */}
                        <div className="flex justify-center gap-4 mt-6">
                        <button 
                            onClick={feedPet}
                            disabled={inventory.food <= 0}
                            className={`flex items-center gap-2 px-6 py-2 rounded-full font-bold shadow-lg transform active:scale-95 transition-all
                            ${inventory.food > 0 
                                ? 'bg-orange-500 text-white hover:bg-orange-600' 
                                : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}
                        >
                            <Utensils size={18} /> Cho ƒÉn
                        </button>
                        
                        <button 
                            onClick={playWithPet}
                            className="flex items-center gap-2 px-6 py-2 rounded-full bg-yellow-400 text-yellow-900 font-bold shadow-lg hover:bg-yellow-300 transform active:scale-95 transition-all"
                        >
                            <Heart size={18} /> Ch∆°i
                        </button>
                        </div>
                    </div>

                    {/* TASKS AREA */}
                    <div className="p-6">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-gray-700">
                        <Zap className="text-yellow-500" /> Nhi·ªám v·ª• d√†i h·∫°n
                        </h2>
                        
                        {/* Input */}
                        <form onSubmit={addTask} className="flex gap-2 mb-6">
                        <input
                            type="text"
                            value={newTaskInput}
                            onChange={(e) => setNewTaskInput(e.target.value)}
                            placeholder="Th√™m vi·ªác c·∫ßn l√†m..."
                            className="flex-1 px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm"
                        />
                        <button 
                            type="submit"
                            className="bg-orange-500 text-white p-3 rounded-xl hover:bg-orange-600 shadow-sm transition-colors"
                        >
                            <Plus size={24} />
                        </button>
                        </form>

                        {/* List */}
                        <div className="space-y-3">
                        {tasks.length === 0 && (
                            <div className="text-center text-gray-400 py-8">
                            Ch∆∞a c√≥ nhi·ªám v·ª• n√†o.<br/>Th√™m vi·ªác ƒë·ªÉ ki·∫øm th·ª©c ƒÉn nh√©!
                            </div>
                        )}
                        
                        {tasks.map(task => (
                            <div 
                            key={task.id}
                            className={`flex items-center p-3 rounded-xl border transition-all duration-300 ${task.completed ? 'bg-gray-50 border-gray-100 opacity-70' : 'bg-white border-gray-100 shadow-sm hover:shadow-md'}`}
                            >
                            <button 
                                onClick={() => toggleTask(task.id)}
                                className={`w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center transition-colors ${task.completed ? 'bg-green-500 border-green-500' : 'border-gray-300 hover:border-orange-500'}`}
                            >
                                {task.completed && <Check size={14} className="text-white" />}
                            </button>
                            
                            <span className={`flex-1 ${task.completed ? 'line-through text-gray-400' : 'text-gray-700'}`}>
                                {task.text}
                            </span>

                            <button 
                                onClick={() => deleteTask(task.id)}
                                className="text-gray-300 hover:text-red-500 p-2 transition-colors"
                            >
                                <Trash2 size={18} />
                            </button>
                            </div>
                        ))}
                        </div>
                    </div>
                    </div>
                    
                    {/* Footer */}
                    <div className="p-4 text-center text-xs text-gray-400 border-t">
                        <button onClick={resetGame} className="hover:text-red-400 underline">Reset Game</button>
                    </div>

                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
